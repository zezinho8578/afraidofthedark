<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afraid of the Dark - Episodes</title>
    <link rel="icon" type="image/png" href="https://media.discordapp.net/attachments/1461536234034827537/1461536302825738250/AOTD_typography_short.png?ex=696c3ac0&is=696ae940&hm=03b59631e6cf033690b321071c0e82b80acf7946c252e1b5947119a613d299b0&=&format=webp&quality=lossless">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        /* --- AFRAID OF THE DARK THEME --- */
        @keyframes flicker { 0%, 100% { opacity: 0.97; } 50% { opacity: 1; } }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 5px var(--accent-color); } 50% { box-shadow: 0 0 20px var(--accent-color); } }

        :root {
            --bg-color: #0a0a0a; 
            --scanline-color: rgba(255, 255, 255, 0.02); 
            --text-color: #d0d0d0;
            --accent-color: #ffffff; 
            --border-color: #333333; 
            --input-bg: #141414;
            --danger-color: #a30000; 
            --danger-bg: rgba(100, 0, 0, 0.15); 
            --container-bg: rgba(15, 15, 15, 0.95);
            --header-font: 'Courier New', Courier, monospace;
            --locked-color: #444444;
            --success-color: #00aa00;
        }

        /* Theme: Classic Dark (default) */
        body.theme-dark {
            --bg-color: #0a0a0a; 
            --text-color: #d0d0d0;
            --accent-color: #ffffff; 
            --border-color: #333333; 
            --input-bg: #141414;
            --container-bg: rgba(15, 15, 15, 0.95);
        }

        /* Theme: Terminal Green */
        body.theme-terminal {
            --bg-color: #0a0f0a; 
            --text-color: #00ff00;
            --accent-color: #00ff00; 
            --border-color: #003300; 
            --input-bg: #0a1a0a;
            --danger-color: #ff3300; 
            --container-bg: rgba(10, 20, 10, 0.95);
        }

        /* Theme: Crimson */
        body.theme-crimson {
            --bg-color: #0f0808; 
            --text-color: #e0c0c0;
            --accent-color: #ff4444; 
            --border-color: #442222; 
            --input-bg: #1a0a0a;
            --danger-color: #ff0000; 
            --container-bg: rgba(20, 10, 10, 0.95);
        }

        /* Theme: Light Mode */
        body.theme-light {
            --bg-color: #f0f0f0; 
            --scanline-color: rgba(0, 0, 0, 0.02); 
            --text-color: #1a1a1a;
            --accent-color: #000000; 
            --border-color: #cccccc; 
            --input-bg: #ffffff;
            --danger-color: #cc0000; 
            --danger-bg: rgba(200, 0, 0, 0.1); 
            --container-bg: rgba(255, 255, 255, 0.95);
            --locked-color: #999999;
        }

        /* Theme: High Contrast */
        body.theme-highcontrast {
            --bg-color: #000000; 
            --text-color: #ffffff;
            --accent-color: #ffff00; 
            --border-color: #ffffff; 
            --input-bg: #000000;
            --danger-color: #ff0000; 
            --danger-bg: rgba(255, 0, 0, 0.2); 
            --container-bg: #000000;
        }

        /* Admin Mode */
        body.admin-mode {
            --border-color: #a30000;
            --accent-color: #ff0000;
        }

        /* Accessibility */
        body.reduce-motion,
        body.reduce-motion * {
            animation: none !important;
            transition: none !important;
        }

        body.large-text { font-size: 18px; }
        body.large-text input, body.large-text select, body.large-text textarea, body.large-text button { font-size: 16px; }
        body.xlarge-text { font-size: 22px; }
        body.xlarge-text input, body.xlarge-text select, body.xlarge-text textarea, body.xlarge-text button { font-size: 18px; }

        body.dyslexia-font, body.dyslexia-font * {
            font-family: 'OpenDyslexic', 'Comic Sans MS', Arial, sans-serif !important;
            letter-spacing: 0.1em;
            word-spacing: 0.2em;
            line-height: 1.8;
        }

        body {
            font-family: 'Courier New', Courier, monospace; 
            margin: 0; 
            background-color: var(--bg-color); 
            color: var(--text-color);
            animation: flicker 0.2s infinite; 
            overflow-y: scroll;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }

        body::before {
            content: " "; display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(0deg, var(--scanline-color) 1px, transparent 1px);
            background-size: 100% 3px; z-index: 100; pointer-events: none;
        }

        body.no-scanlines::before { display: none; }

        .container { 
            position: relative; 
            max-width: 1400px; 
            margin: 10px auto; 
            padding: 20px; 
            border: 1px solid var(--border-color); 
            background: var(--container-bg); 
            box-shadow: 0 0 20px rgba(0,0,0,0.8); 
        }

        .header { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            border-bottom: 2px solid var(--border-color); 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
        }
        .header-logo-main { max-width: 120px; margin-bottom: 10px; filter: invert(1) brightness(0.8); }
        .header-title-img { max-width: 90%; height: auto; filter: invert(1) brightness(0.9); }
        
        body.theme-light .header-logo-main,
        body.theme-light .header-title-img { filter: none; }

        h1 { font-size: 16px; text-transform: uppercase; letter-spacing: 3px; color: #555; margin-top: 5px; }
        h2 { font-size: 18px; margin-top: 10px; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid var(--border-color); padding-bottom: 4px; color: var(--accent-color); letter-spacing: 1px; }
        h3 { font-size: 14px; text-transform: uppercase; margin: 0 0 10px 0; color: #888; }

        button, .button {
            background: rgba(255,255,255,0.05); 
            color: var(--text-color); 
            border: 1px solid var(--border-color);
            padding: 8px 15px; 
            font-size: 14px; 
            cursor: pointer; 
            margin: 5px;
            font-family: 'Courier New', Courier, monospace; 
            text-transform: uppercase; 
            transition: all 0.2s;
        }
        button:hover, .button:hover { 
            background: var(--text-color); 
            color: var(--bg-color); 
            border-color: var(--accent-color); 
        }
        button:disabled { 
            cursor: not-allowed; 
            opacity: 0.3; 
        }

        .hidden { display: none !important; }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            letter-spacing: 3px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .connection-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 11px;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            z-index: 150;
        }

        .connection-status.connected { border-color: var(--success-color); color: var(--success-color); }
        .connection-status.disconnected { border-color: var(--danger-color); color: var(--danger-color); }
        .connection-status.connecting { border-color: #ffaa00; color: #ffaa00; }

        /* Navigation */
        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-bar a {
            color: var(--text-color);
            text-decoration: none;
            padding: 8px 15px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .nav-bar a:hover {
            background: var(--text-color);
            color: var(--bg-color);
        }

        /* Season Selection */
        .season-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .season-card {
            background: var(--input-bg);
            border: 2px solid var(--border-color);
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .season-card:hover:not(.locked) {
            border-color: var(--accent-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .season-card.locked {
            cursor: not-allowed;
            opacity: 0.4;
        }

        .season-card.locked::after {
            content: "üîí";
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }

        .season-card h3 {
            font-size: 24px;
            margin: 0 0 10px 0;
            color: var(--accent-color);
        }

        .season-card .episode-count {
            font-size: 12px;
            color: #666;
        }

        .season-card.locked h3,
        .season-card.locked .episode-count {
            color: var(--locked-color);
        }

        /* Episode List */
        .episode-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .episode-card {
            display: flex;
            gap: 20px;
            background: var(--input-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            transition: all 0.2s;
        }

        .episode-card:hover {
            border-color: var(--accent-color);
        }

        .episode-thumbnail {
            width: 200px;
            height: 112px;
            background: #000;
            border: 1px solid var(--border-color);
            flex-shrink: 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .episode-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(70%);
            transition: filter 0.3s;
        }

        .episode-card:hover .episode-thumbnail img {
            filter: grayscale(30%);
        }

        .episode-thumbnail .no-thumb {
            color: #444;
            font-size: 40px;
        }

        .episode-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .episode-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .episode-number {
            font-size: 12px;
            color: var(--danger-color);
            letter-spacing: 2px;
        }

        .episode-title {
            font-size: 18px;
            color: var(--accent-color);
            margin: 5px 0;
        }

        .episode-meta {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        .episode-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .episode-summary {
            font-size: 14px;
            line-height: 1.5;
            color: #999;
            flex-grow: 1;
        }

        .episode-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .episode-actions button {
            padding: 5px 10px;
            font-size: 12px;
            margin: 0;
        }

        /* Admin Panel */
        .admin-controls {
            background: var(--danger-bg);
            border: 1px solid var(--danger-color);
            padding: 15px;
            margin-bottom: 20px;
        }

        .admin-controls h3 {
            color: var(--danger-color);
            margin-bottom: 15px;
        }

        /* Modal */
        .modal-overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.9); 
            z-index: 200; 
            display: flex; 
            justify-content: center; 
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content { 
            background: var(--bg-color); 
            border: 1px solid var(--accent-color); 
            padding: 25px; 
            max-width: 700px; 
            width: 100%; 
            max-height: 90vh; 
            overflow-y: auto; 
            box-shadow: 0 0 50px rgba(0,0,0,0.8); 
        }

        .modal-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
        }

        .modal-header h2 {
            margin: 0;
            border: none;
            padding: 0;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 15px;
        }

        label { 
            font-weight: bold; 
            display: block; 
            margin-bottom: 5px; 
            color: #888; 
            font-size: 12px; 
            letter-spacing: 1px; 
        }

        input, select, textarea {
            width: 100%; 
            padding: 10px; 
            box-sizing: border-box; 
            background-color: #000; 
            color: var(--text-color);
            border: 1px solid var(--border-color); 
            font-family: 'Courier New', Courier, monospace; 
            font-size: 14px;
        }

        body.theme-light input,
        body.theme-light select,
        body.theme-light textarea {
            background-color: #ffffff;
        }

        input:focus, select:focus, textarea:focus { 
            border-color: var(--accent-color); 
            outline: none; 
            background-color: #111; 
        }

        textarea { 
            resize: vertical; 
            min-height: 100px; 
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Thumbnail Preview */
        .thumbnail-preview {
            width: 200px;
            height: 112px;
            border: 1px dashed var(--border-color);
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
            overflow: hidden;
        }

        .thumbnail-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .thumbnail-preview .placeholder {
            color: #444;
            font-size: 12px;
            text-align: center;
        }

        /* Episode Detail View */
        .episode-detail-header {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }

        .episode-detail-thumb {
            width: 400px;
            height: 225px;
            background: #000;
            border: 1px solid var(--border-color);
            flex-shrink: 0;
            overflow: hidden;
        }

        .episode-detail-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .episode-detail-info h2 {
            border: none;
            margin-top: 0;
        }

        .full-summary {
            background: var(--input-bg);
            padding: 20px;
            border: 1px solid var(--border-color);
            line-height: 1.8;
            white-space: pre-wrap;
        }

        /* Settings */
        .settings-container { position: absolute; top: 10px; right: 10px; }
        
        #settings-menu { 
            display: none; 
            position: absolute; 
            top: 100%; 
            right: 0; 
            background: var(--bg-color); 
            border: 1px solid var(--border-color); 
            padding: 10px; 
            z-index: 101; 
            min-width: 220px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        #settings-menu h4 {
            margin: 15px 0 8px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            color: var(--accent-color);
            font-size: 12px;
            letter-spacing: 1px;
        }
        
        #settings-menu h4:first-child { margin-top: 0; }
        #settings-menu button { display: block; width: 100%; text-align: left; margin: 0 0 5px 0; }
        #settings-menu button.active { background: var(--accent-color); color: var(--bg-color); }
        
        #settings-menu .settings-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            padding: 5px 0;
        }
        
        #settings-menu .settings-row label {
            margin: 0;
            color: var(--text-color);
            font-weight: normal;
            cursor: pointer;
        }

        .styled-checkbox { display: flex; align-items: center; cursor: pointer; user-select: none; }
        .styled-checkbox input[type="checkbox"] { display: none; }
        .styled-checkbox .checkbox-visual { 
            width: 14px; 
            height: 14px; 
            border: 1px solid var(--text-color); 
            display: inline-block; 
            position: relative; 
            flex-shrink: 0; 
        }
        .styled-checkbox input[type="checkbox"]:checked + .checkbox-visual { 
            background: var(--danger-color); 
            border-color: var(--danger-color); 
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #555;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .empty-state p {
            margin-bottom: 20px;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .breadcrumb a {
            color: var(--text-color);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: var(--accent-color);
            text-decoration: underline;
        }

        .breadcrumb .separator {
            color: #555;
        }

        .breadcrumb .current {
            color: var(--accent-color);
        }

        /* Error State */
        .error-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--danger-color);
        }

        .error-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { margin: 0; padding: 10px; border: none; }
            .season-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
            .episode-card { flex-direction: column; }
            .episode-thumbnail { width: 100%; height: 180px; }
            .form-row { grid-template-columns: 1fr; }
            .episode-detail-header { flex-direction: column; }
            .episode-detail-thumb { width: 100%; height: auto; aspect-ratio: 16/9; }
        }
    </style>
</head>
<body class="theme-dark">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">CONNECTING TO DATABASE...</div>
    </div>

    <!-- Connection Status -->
    <div id="connection-status" class="connection-status connecting">‚óè CONNECTING</div>

    <div class="container">
        <header class="header"> 
            <img src="https://media.discordapp.net/attachments/1461536234034827537/1461536301856592004/AOTD_logo_1.png?ex=696ae940&is=696997c0&hm=b81f1cf08ec65edd2805a22716ab8d38d798ea7cb42f8a7098f26813fe1378e6&=&format=webp&quality=lossless" alt="AOTD Logo" class="header-logo-main">
            <img src="https://media.discordapp.net/attachments/1461536234034827537/1461536301437288674/aotd_title_card.png?ex=696c3ac0&is=696ae940&hm=ffeaf48c2fbabbfd08ddb6ebefeafcd2de8505a17dd8626f157d0627f99e19c9&=&format=webp&quality=lossless&width=1288&height=346" alt="Afraid of the Dark" class="header-title-img">
            <h1>// EPISODE ARCHIVE //</h1> 
        </header>

        <div class="settings-container"> 
            <button id="settings-btn">SYSTEM</button> 
            <div id="settings-menu">
                <h4>THEMES</h4>
                <button id="theme-dark-btn" class="active" onclick="setTheme('dark')">Classic Dark</button>
                <button id="theme-terminal-btn" onclick="setTheme('terminal')">Terminal Green</button>
                <button id="theme-crimson-btn" onclick="setTheme('crimson')">Crimson</button>
                <button id="theme-light-btn" onclick="setTheme('light')">Light Mode</button>
                <button id="theme-highcontrast-btn" onclick="setTheme('highcontrast')">High Contrast</button>
                
                <h4>ACCESSIBILITY</h4>
                <div class="settings-row">
                    <label class="styled-checkbox">
                        <input type="checkbox" id="reduce-motion-checkbox" onchange="toggleAccessibility('reduce-motion', this.checked)">
                        <span class="checkbox-visual"></span>
                    </label>
                    <label for="reduce-motion-checkbox">Reduce Motion</label>
                </div>
                <div class="settings-row">
                    <label class="styled-checkbox">
                        <input type="checkbox" id="no-scanlines-checkbox" onchange="toggleAccessibility('no-scanlines', this.checked)">
                        <span class="checkbox-visual"></span>
                    </label>
                    <label for="no-scanlines-checkbox">Hide Scanlines</label>
                </div>
                <div class="settings-row">
                    <label class="styled-checkbox">
                        <input type="checkbox" id="dyslexia-font-checkbox" onchange="toggleAccessibility('dyslexia-font', this.checked)">
                        <span class="checkbox-visual"></span>
                    </label>
                    <label for="dyslexia-font-checkbox">Dyslexia Font</label>
                </div>
                
                <h4>TEXT SIZE</h4>
                <button id="text-normal-btn" class="active" onclick="setTextSize('normal')">Normal</button>
                <button id="text-large-btn" onclick="setTextSize('large')">Large</button>
                <button id="text-xlarge-btn" onclick="setTextSize('xlarge')">Extra Large</button>
                
                <h4>ADMIN</h4>
                <button id="admin-login-btn" onclick="toggleAdminMode()">Admin Login</button>
            </div> 
        </div>

        <nav class="nav-bar">
            <a href="index.html">&lt; RETURN TO TERMINAL</a>
            <span id="admin-indicator" class="hidden" style="color: var(--danger-color);">[ ADMIN MODE ACTIVE ]</span>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Season Selection View -->
            <div id="season-view">
                <h2>SELECT SEASON</h2>
                
                <!-- Admin Controls -->
                <div id="admin-season-controls" class="admin-controls hidden">
                    <h3>SEASON MANAGEMENT</h3>
                    <button onclick="unlockNextSeason()">UNLOCK NEXT SEASON</button>
                    <button onclick="lockLastSeason()">LOCK LAST SEASON</button>
                    <span id="unlock-status" style="margin-left: 15px; color: #666;"></span>
                </div>

                <div class="season-grid" id="season-grid">
                    <!-- Seasons will be rendered here -->
                </div>
            </div>

            <!-- Episode List View -->
            <div id="episode-list-view" class="hidden">
                <div class="breadcrumb">
                    <a href="#" onclick="showSeasonView(); return false;">Seasons</a>
                    <span class="separator">//</span>
                    <span class="current" id="current-season-label">Season 1</span>
                </div>

                <!-- Admin Controls -->
                <div id="admin-episode-controls" class="admin-controls hidden">
                    <h3>EPISODE MANAGEMENT</h3>
                    <button onclick="openAddEpisodeModal()">+ ADD NEW EPISODE</button>
                </div>

                <div class="episode-list" id="episode-list">
                    <!-- Episodes will be rendered here -->
                </div>
            </div>

            <!-- Episode Detail View -->
            <div id="episode-detail-view" class="hidden">
                <div class="breadcrumb">
                    <a href="#" onclick="showSeasonView(); return false;">Seasons</a>
                    <span class="separator">//</span>
                    <a href="#" id="back-to-season-link">Season 1</a>
                    <span class="separator">//</span>
                    <span class="current" id="current-episode-label">Episode 1</span>
                </div>

                <div id="episode-detail-content">
                    <!-- Episode details will be rendered here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Episode Modal -->
    <div id="episode-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">ADD NEW EPISODE</h2>
                <button onclick="closeEpisodeModal()">CLOSE</button>
            </div>
            
            <form id="episode-form" onsubmit="return false;">
                <input type="hidden" id="episode-id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="episode-season">SEASON</label>
                        <select id="episode-season"></select>
                    </div>
                    <div class="form-group">
                        <label for="episode-number">EPISODE NUMBER</label>
                        <input type="number" id="episode-number" min="1" value="1">
                    </div>
                </div>

                <div class="form-group">
                    <label for="episode-title">EPISODE TITLE</label>
                    <input type="text" id="episode-title" placeholder="Enter episode title...">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="episode-length">LENGTH</label>
                        <input type="text" id="episode-length" placeholder="e.g., 2h 30m">
                    </div>
                    <div class="form-group">
                        <label for="episode-date">AIR DATE</label>
                        <input type="date" id="episode-date">
                    </div>
                </div>

                <div class="form-group">
                    <label for="episode-thumbnail">THUMBNAIL URL</label>
                    <input type="text" id="episode-thumbnail" placeholder="Enter image URL..." oninput="updateThumbnailPreview()">
                    <div class="thumbnail-preview" id="thumbnail-preview">
                        <span class="placeholder">No thumbnail</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="episode-summary">SHORT SUMMARY</label>
                    <textarea id="episode-summary" placeholder="Brief episode description (shown in list view)..." rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label for="episode-full-summary">FULL SESSION NOTES</label>
                    <textarea id="episode-full-summary" placeholder="Detailed session summary, events, and notes..." rows="8"></textarea>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" onclick="closeEpisodeModal()">CANCEL</button>
                    <button type="button" id="save-episode-btn" onclick="saveEpisode()" style="background: var(--danger-color); border-color: var(--danger-color);">SAVE EPISODE</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h2 style="margin-bottom: 20px;">CONFIRM DELETION</h2>
            <p id="delete-message" style="margin-bottom: 25px; color: #999;"></p>
            <button onclick="confirmDelete()" style="background: var(--danger-color); border-color: var(--danger-color);">DELETE</button>
            <button onclick="closeDeleteModal()">CANCEL</button>
        </div>
    </div>

<script>
    // ============================================================
    // FIREBASE CONFIGURATION
    // ============================================================
    // 
    // TO SET UP FIREBASE:
    // 1. Go to https://console.firebase.google.com/
    // 2. Create a new project (or use existing)
    // 3. Go to "Build" > "Realtime Database"
    // 4. Click "Create Database" (start in TEST MODE for now)
    // 5. Go to Project Settings > General > Your apps > Web app
    // 6. Register your app and copy the config below
    // 7. Replace the placeholder config with your actual config
    //
    // IMPORTANT: Set up security rules in Firebase Console:
    // {
    //   "rules": {
    //     ".read": true,
    //     ".write": false,
    //     "episodes": { ".write": true },
    //     "settings": { ".write": true }
    //   }
    // }
    // ============================================================

    const firebaseConfig = {
        // REPLACE THESE WITH YOUR FIREBASE CONFIG
        apiKey: "AIzaSyAfSyEavpC2piXdYOQTdkj8DV--djZWJWM",
        authDomain: "afraidofthedark-83b3c.firebaseapp.com",
        databaseURL: "https://afraidofthedark-83b3c-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "afraidofthedark-83b3c",
        storageBucket: "afraidofthedark-83b3c.firebasestorage.app",
        messagingSenderId: "63737248707",
        appId: "1:63737248707:web:4da1fa983dc8beb3acdb76"
    };

    // Flag to check if Firebase is configured
    const isFirebaseConfigured = firebaseConfig.apiKey !== "YOUR_API_KEY";

    // --- CONFIG & STATE ---
    const ADMIN_PASSWORD_HASH = 'dmFsa3lyaWU=';
    let isAdmin = false;
    let currentSeason = 1;
    let currentEpisodeId = null;
    let deleteTargetId = null;
    let db = null;
    let isConnected = false;
    
    // Season unlock state
    let unlockedSeasons = 1;
    
    // Episodes data
    let episodes = [];

    // --- INITIALIZATION ---
    window.onload = async () => {
        loadSettings();
        setupEventListeners();
        
        if (isFirebaseConfigured) {
            await initFirebase();
        } else {
            console.warn('Firebase not configured. Using localStorage fallback.');
            loadFromLocalStorage();
            hideLoading();
            updateConnectionStatus('disconnected', 'LOCAL MODE');
        }
    };

    async function initFirebase() {
        try {
            updateConnectionStatus('connecting', 'CONNECTING');
            
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            
            // Set up real-time listeners
            setupRealtimeListeners();
            
            // Test connection
            const connectedRef = db.ref('.info/connected');
            connectedRef.on('value', (snap) => {
                if (snap.val() === true) {
                    isConnected = true;
                    updateConnectionStatus('connected', 'CONNECTED');
                } else {
                    isConnected = false;
                    updateConnectionStatus('disconnected', 'OFFLINE');
                }
            });
            
        } catch (error) {
            console.error('Firebase initialization error:', error);
            updateConnectionStatus('disconnected', 'ERROR');
            loadFromLocalStorage();
            hideLoading();
        }
    }

    function setupRealtimeListeners() {
        // Listen for episodes changes
        db.ref('episodes').on('value', (snapshot) => {
            const data = snapshot.val();
            episodes = data ? Object.values(data) : [];
            
            // Also save to localStorage as backup
            localStorage.setItem('aotd_episodes_backup', JSON.stringify(episodes));
            
            renderCurrentView();
            hideLoading();
        }, (error) => {
            console.error('Error reading episodes:', error);
            loadFromLocalStorage();
            hideLoading();
        });

        // Listen for settings changes
        db.ref('settings/unlockedSeasons').on('value', (snapshot) => {
            const data = snapshot.val();
            unlockedSeasons = data || 1;
            localStorage.setItem('aotd_unlocked_seasons_backup', unlockedSeasons.toString());
            updateUnlockStatus();
            renderSeasons();
        });
    }

    function loadFromLocalStorage() {
        // Load episodes from localStorage backup
        const savedEpisodes = localStorage.getItem('aotd_episodes_backup');
        if (savedEpisodes) {
            episodes = JSON.parse(savedEpisodes);
        } else {
            // Sample data
            episodes = getSampleData();
        }
        
        // Load unlock state
        const savedUnlock = localStorage.getItem('aotd_unlocked_seasons_backup');
        unlockedSeasons = savedUnlock ? parseInt(savedUnlock, 10) : 1;
        
        updateUnlockStatus();
        renderSeasons();
    }

    function getSampleData() {
        return [
            {
                id: 'ep_sample_1',
                season: 1,
                episode: 1,
                title: 'Pilot: The First Night',
                thumbnail: '',
                length: '3h 15m',
                airDate: '2024-01-15',
                summary: 'The team is assembled for their first operation. Something lurks in the abandoned facility...',
                fullSummary: 'SESSION NOTES:\n\nThe agents received their first briefing at the safehouse. Handler "Sphinx" provided minimal information - a missing research team at Site-17.\n\nKey Events:\n- Initial team introductions and cover establishment\n- Discovery of the abandoned research wing\n- First encounter with the anomaly (SAN loss: 1/1d4)\n- Agent Martinez wounded during extraction\n\nInvestigation Leads:\n- Dr. Elena Voss - last seen entering Lab 3B\n- Security footage shows movement at 0247 hours\n- Recovered documents reference "Project LIGHTHOUSE"\n\nCasualties: None (1 wounded)\nSAN Loss: All agents suffered minor losses'
            },
            {
                id: 'ep_sample_2',
                season: 1,
                episode: 2,
                title: 'The Paper Trail',
                thumbnail: '',
                length: '2h 45m',
                airDate: '2024-01-22',
                summary: 'Following leads from the first operation, the agents dig into the bureaucratic nightmare surrounding Project LIGHTHOUSE.',
                fullSummary: 'SESSION NOTES:\n\nA quieter session focused on investigation and social encounters.\n\nKey Events:\n- Bureaucracy rolls to access classified archives\n- Meeting with retired Agent "Coldwater"\n- Discovery of the connection to 1987 incident\n- HUMINT operation at the university\n\nNew NPCs:\n- Prof. Harold Webb - Occult Studies, knows more than he admits\n- Sarah Chen - NSA analyst, potential ally or threat?\n\nClues Gathered:\n- LIGHTHOUSE was shut down after "containment failure"\n- Three survivors from original team still alive\n- Pattern of similar incidents dating back to 1952'
            }
        ];
    }

    function hideLoading() {
        document.getElementById('loading-overlay').classList.add('hidden');
    }

    function updateConnectionStatus(status, text) {
        const el = document.getElementById('connection-status');
        el.className = `connection-status ${status}`;
        el.textContent = `‚óè ${text}`;
    }

    function renderCurrentView() {
        if (!document.getElementById('season-view').classList.contains('hidden')) {
            renderSeasons();
        } else if (!document.getElementById('episode-list-view').classList.contains('hidden')) {
            renderEpisodes(currentSeason);
        } else if (!document.getElementById('episode-detail-view').classList.contains('hidden')) {
            renderEpisodeDetail(currentEpisodeId);
        }
    }

    function setupEventListeners() {
        document.getElementById('settings-btn').addEventListener('click', (e) => { 
            e.stopPropagation();
            const menu = document.getElementById('settings-menu');
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block'; 
        });
        
        document.addEventListener('click', (e) => {
            const settingsMenu = document.getElementById('settings-menu');
            const settingsBtn = document.getElementById('settings-btn');
            if (!settingsMenu.contains(e.target) && e.target !== settingsBtn) {
                settingsMenu.style.display = 'none';
            }
        });
    }

    // --- FIREBASE DATA OPERATIONS ---
    async function saveEpisodeToFirebase(episodeData) {
        if (!isFirebaseConfigured || !db) {
            // Fallback to localStorage
            const index = episodes.findIndex(e => e.id === episodeData.id);
            if (index !== -1) {
                episodes[index] = episodeData;
            } else {
                episodes.push(episodeData);
            }
            localStorage.setItem('aotd_episodes_backup', JSON.stringify(episodes));
            renderCurrentView();
            return;
        }
        
        try {
            await db.ref(`episodes/${episodeData.id}`).set(episodeData);
        } catch (error) {
            console.error('Error saving episode:', error);
            alert('Error saving episode. Changes saved locally.');
            // Save to localStorage as backup
            const index = episodes.findIndex(e => e.id === episodeData.id);
            if (index !== -1) {
                episodes[index] = episodeData;
            } else {
                episodes.push(episodeData);
            }
            localStorage.setItem('aotd_episodes_backup', JSON.stringify(episodes));
        }
    }

    async function deleteEpisodeFromFirebase(episodeId) {
        if (!isFirebaseConfigured || !db) {
            // Fallback to localStorage
            const index = episodes.findIndex(e => e.id === episodeId);
            if (index !== -1) {
                episodes.splice(index, 1);
                localStorage.setItem('aotd_episodes_backup', JSON.stringify(episodes));
            }
            renderCurrentView();
            return;
        }
        
        try {
            await db.ref(`episodes/${episodeId}`).remove();
        } catch (error) {
            console.error('Error deleting episode:', error);
            alert('Error deleting episode.');
        }
    }

    async function saveUnlockedSeasons(count) {
        unlockedSeasons = count;
        localStorage.setItem('aotd_unlocked_seasons_backup', count.toString());
        
        if (!isFirebaseConfigured || !db) {
            updateUnlockStatus();
            renderSeasons();
            return;
        }
        
        try {
            await db.ref('settings/unlockedSeasons').set(count);
        } catch (error) {
            console.error('Error saving unlock state:', error);
        }
    }

    // --- THEME & SETTINGS ---
    let currentTheme = 'dark';
    let currentTextSize = 'normal';

    function setTheme(themeName) {
        const themes = ['dark', 'terminal', 'crimson', 'light', 'highcontrast'];
        themes.forEach(t => document.body.classList.remove(`theme-${t}`));
        document.body.classList.add(`theme-${themeName}`);
        currentTheme = themeName;
        
        document.querySelectorAll('#settings-menu button[id^="theme-"]').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`theme-${themeName}-btn`).classList.add('active');
        
        saveSettings();
    }

    function setTextSize(size) {
        document.body.classList.remove('large-text', 'xlarge-text');
        if (size === 'large') {
            document.body.classList.add('large-text');
        } else if (size === 'xlarge') {
            document.body.classList.add('xlarge-text');
        }
        currentTextSize = size;
        
        document.querySelectorAll('#settings-menu button[id^="text-"]').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`text-${size}-btn`).classList.add('active');
        
        saveSettings();
    }

    function toggleAccessibility(option, enabled) {
        if (enabled) {
            document.body.classList.add(option);
        } else {
            document.body.classList.remove(option);
        }
        saveSettings();
    }

    function saveSettings() {
        const settings = {
            theme: currentTheme,
            textSize: currentTextSize,
            reduceMotion: document.body.classList.contains('reduce-motion'),
            noScanlines: document.body.classList.contains('no-scanlines'),
            dyslexiaFont: document.body.classList.contains('dyslexia-font')
        };
        localStorage.setItem('aotd_settings', JSON.stringify(settings));
    }

    function loadSettings() {
        const saved = localStorage.getItem('aotd_settings');
        if (saved) {
            const settings = JSON.parse(saved);
            setTheme(settings.theme || 'dark');
            setTextSize(settings.textSize || 'normal');
            
            if (settings.reduceMotion) {
                document.body.classList.add('reduce-motion');
                document.getElementById('reduce-motion-checkbox').checked = true;
            }
            if (settings.noScanlines) {
                document.body.classList.add('no-scanlines');
                document.getElementById('no-scanlines-checkbox').checked = true;
            }
            if (settings.dyslexiaFont) {
                document.body.classList.add('dyslexia-font');
                document.getElementById('dyslexia-font-checkbox').checked = true;
            }
        }
    }

    // --- ADMIN MODE ---
    function toggleAdminMode() {
        if (isAdmin) {
            isAdmin = false;
            document.body.classList.remove('admin-mode');
            document.getElementById('admin-login-btn').textContent = 'Admin Login';
            document.getElementById('admin-indicator').classList.add('hidden');
            updateAdminUI();
            alert('Admin mode deactivated.');
        } else {
            const pass = prompt('Enter SYSTEM OVERRIDE code:');
            if (btoa(pass) === ADMIN_PASSWORD_HASH) {
                isAdmin = true;
                document.body.classList.add('admin-mode');
                document.getElementById('admin-login-btn').textContent = 'Admin Logout';
                document.getElementById('admin-indicator').classList.remove('hidden');
                updateAdminUI();
                alert('Override accepted. Modification privileges granted.');
            } else if (pass) { 
                alert('Invalid Credentials.'); 
            }
        }
    }

    function updateAdminUI() {
        document.getElementById('admin-season-controls').classList.toggle('hidden', !isAdmin);
        document.getElementById('admin-episode-controls').classList.toggle('hidden', !isAdmin);
        renderCurrentView();
    }

    // --- SEASON MANAGEMENT ---
    function renderSeasons() {
        const grid = document.getElementById('season-grid');
        let html = '';
        
        for (let i = 1; i <= 6; i++) {
            const isLocked = i > unlockedSeasons;
            const episodeCount = episodes.filter(ep => ep.season === i).length;
            
            html += `
                <div class="season-card ${isLocked ? 'locked' : ''}" 
                     onclick="${isLocked ? '' : `selectSeason(${i})`}">
                    <h3>SEASON ${i}</h3>
                    <div class="episode-count">${episodeCount} EPISODE${episodeCount !== 1 ? 'S' : ''}</div>
                    ${isLocked ? '<div style="margin-top: 10px; font-size: 11px; color: #555;">CLASSIFIED</div>' : ''}
                </div>
            `;
        }
        
        grid.innerHTML = html;
    }

    function selectSeason(season) {
        currentSeason = season;
        showEpisodeList(season);
    }

    function unlockNextSeason() {
        if (unlockedSeasons < 6) {
            saveUnlockedSeasons(unlockedSeasons + 1);
        }
    }

    function lockLastSeason() {
        if (unlockedSeasons > 1) {
            saveUnlockedSeasons(unlockedSeasons - 1);
        }
    }

    function updateUnlockStatus() {
        const status = document.getElementById('unlock-status');
        if (status) {
            status.textContent = `Currently unlocked: Seasons 1-${unlockedSeasons}`;
        }
    }

    // --- VIEW NAVIGATION ---
    function showSeasonView() {
        document.getElementById('season-view').classList.remove('hidden');
        document.getElementById('episode-list-view').classList.add('hidden');
        document.getElementById('episode-detail-view').classList.add('hidden');
        document.getElementById('admin-season-controls').classList.toggle('hidden', !isAdmin);
        renderSeasons();
    }

    function showEpisodeList(season) {
        currentSeason = season;
        document.getElementById('season-view').classList.add('hidden');
        document.getElementById('episode-list-view').classList.remove('hidden');
        document.getElementById('episode-detail-view').classList.add('hidden');
        document.getElementById('current-season-label').textContent = `Season ${season}`;
        document.getElementById('admin-episode-controls').classList.toggle('hidden', !isAdmin);
        renderEpisodes(season);
    }

    function showEpisodeDetail(episodeId) {
        currentEpisodeId = episodeId;
        document.getElementById('season-view').classList.add('hidden');
        document.getElementById('episode-list-view').classList.add('hidden');
        document.getElementById('episode-detail-view').classList.remove('hidden');
        renderEpisodeDetail(episodeId);
    }

    // --- EPISODE RENDERING ---
    function renderEpisodes(season) {
        const list = document.getElementById('episode-list');
        const seasonEpisodes = episodes
            .filter(ep => ep.season === season)
            .sort((a, b) => a.episode - b.episode);
        
        if (seasonEpisodes.length === 0) {
            list.innerHTML = `
                <div class="empty-state">
                    <h3>NO EPISODES RECORDED</h3>
                    <p>This season has no documented sessions yet.</p>
                    ${isAdmin ? '<button onclick="openAddEpisodeModal()">+ ADD FIRST EPISODE</button>' : ''}
                </div>
            `;
            return;
        }
        
        list.innerHTML = seasonEpisodes.map(ep => `
            <div class="episode-card">
                <div class="episode-thumbnail">
                    ${ep.thumbnail ? 
                        `<img src="${ep.thumbnail}" alt="${escapeHtml(ep.title)}" onerror="this.parentElement.innerHTML='<span class=\\'no-thumb\\'>‚ñ∂</span>'">` : 
                        '<span class="no-thumb">‚ñ∂</span>'
                    }
                </div>
                <div class="episode-info">
                    <div class="episode-header">
                        <div>
                            <div class="episode-number">S${String(ep.season).padStart(2, '0')}E${String(ep.episode).padStart(2, '0')}</div>
                            <h3 class="episode-title">${escapeHtml(ep.title)}</h3>
                        </div>
                    </div>
                    <div class="episode-meta">
                        <span>‚è± ${ep.length || 'Unknown'}</span>
                        <span>üìÖ ${ep.airDate ? formatDate(ep.airDate) : 'Unknown'}</span>
                    </div>
                    <p class="episode-summary">${escapeHtml(ep.summary || 'No summary available.')}</p>
                    <div class="episode-actions">
                        <button onclick="showEpisodeDetail('${ep.id}')">VIEW DETAILS</button>
                        ${isAdmin ? `
                            <button onclick="openEditEpisodeModal('${ep.id}')">EDIT</button>
                            <button onclick="openDeleteModal('${ep.id}')" style="color: var(--danger-color);">DELETE</button>
                        ` : ''}
                    </div>
                </div>
            </div>
        `).join('');
    }

    function renderEpisodeDetail(episodeId) {
        const ep = episodes.find(e => e.id === episodeId);
        if (!ep) {
            showEpisodeList(currentSeason);
            return;
        }
        
        document.getElementById('back-to-season-link').textContent = `Season ${ep.season}`;
        document.getElementById('back-to-season-link').onclick = () => { showEpisodeList(ep.season); return false; };
        document.getElementById('current-episode-label').textContent = `Episode ${ep.episode}`;
        
        const content = document.getElementById('episode-detail-content');
        content.innerHTML = `
            <div class="episode-detail-header">
                <div class="episode-detail-thumb">
                    ${ep.thumbnail ? 
                        `<img src="${ep.thumbnail}" alt="${escapeHtml(ep.title)}" onerror="this.parentElement.innerHTML='<div style=\\'text-align:center;padding-top:90px;color:#444;font-size:40px;\\'>‚ñ∂</div>'">` : 
                        '<div style="text-align:center;padding-top:90px;color:#444;font-size:40px;">‚ñ∂</div>'
                    }
                </div>
                <div class="episode-detail-info">
                    <div class="episode-number">SEASON ${ep.season} // EPISODE ${ep.episode}</div>
                    <h2>${escapeHtml(ep.title)}</h2>
                    <div class="episode-meta" style="margin: 15px 0;">
                        <span>‚è± Duration: ${ep.length || 'Unknown'}</span>
                        <span>üìÖ Date: ${ep.airDate ? formatDate(ep.airDate) : 'Unknown'}</span>
                    </div>
                    <p style="color: #999; line-height: 1.6;">${escapeHtml(ep.summary || 'No summary available.')}</p>
                    ${isAdmin ? `
                        <div style="margin-top: 20px;">
                            <button onclick="openEditEpisodeModal('${ep.id}')">EDIT EPISODE</button>
                            <button onclick="openDeleteModal('${ep.id}')" style="color: var(--danger-color);">DELETE</button>
                        </div>
                    ` : ''}
                </div>
            </div>
            
            <h2 style="margin-top: 30px;">SESSION NOTES</h2>
            <div class="full-summary">${escapeHtml(ep.fullSummary || 'No detailed notes available for this session.')}</div>
        `;
    }

    // --- EPISODE MODAL ---
    function openAddEpisodeModal() {
        document.getElementById('modal-title').textContent = 'ADD NEW EPISODE';
        document.getElementById('episode-form').reset();
        document.getElementById('episode-id').value = '';
        
        // Populate season dropdown
        const seasonSelect = document.getElementById('episode-season');
        seasonSelect.innerHTML = '';
        for (let i = 1; i <= unlockedSeasons; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `Season ${i}`;
            if (i === currentSeason) option.selected = true;
            seasonSelect.appendChild(option);
        }
        
        // Set episode number to next available
        const seasonEpisodes = episodes.filter(ep => ep.season === currentSeason);
        const nextEpisode = seasonEpisodes.length > 0 ? Math.max(...seasonEpisodes.map(e => e.episode)) + 1 : 1;
        document.getElementById('episode-number').value = nextEpisode;
        
        updateThumbnailPreview();
        document.getElementById('episode-modal').classList.remove('hidden');
    }

    function openEditEpisodeModal(episodeId) {
        const ep = episodes.find(e => e.id === episodeId);
        if (!ep) return;
        
        document.getElementById('modal-title').textContent = 'EDIT EPISODE';
        document.getElementById('episode-id').value = ep.id;
        
        // Populate season dropdown
        const seasonSelect = document.getElementById('episode-season');
        seasonSelect.innerHTML = '';
        for (let i = 1; i <= unlockedSeasons; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = `Season ${i}`;
            if (i === ep.season) option.selected = true;
            seasonSelect.appendChild(option);
        }
        
        document.getElementById('episode-number').value = ep.episode;
        document.getElementById('episode-title').value = ep.title;
        document.getElementById('episode-length').value = ep.length || '';
        document.getElementById('episode-date').value = ep.airDate || '';
        document.getElementById('episode-thumbnail').value = ep.thumbnail || '';
        document.getElementById('episode-summary').value = ep.summary || '';
        document.getElementById('episode-full-summary').value = ep.fullSummary || '';
        
        updateThumbnailPreview();
        document.getElementById('episode-modal').classList.remove('hidden');
    }

    function closeEpisodeModal() {
        document.getElementById('episode-modal').classList.add('hidden');
    }

    function updateThumbnailPreview() {
        const url = document.getElementById('episode-thumbnail').value;
        const preview = document.getElementById('thumbnail-preview');
        
        if (url) {
            preview.innerHTML = `<img src="${url}" alt="Preview" onerror="this.parentElement.innerHTML='<span class=\\'placeholder\\'>Invalid URL</span>'">`;
        } else {
            preview.innerHTML = '<span class="placeholder">No thumbnail</span>';
        }
    }

    async function saveEpisode() {
        const id = document.getElementById('episode-id').value;
        const season = parseInt(document.getElementById('episode-season').value, 10);
        const episodeNum = parseInt(document.getElementById('episode-number').value, 10);
        const title = document.getElementById('episode-title').value.trim();
        
        if (!title) {
            alert('Episode title is required.');
            return;
        }
        
        const saveBtn = document.getElementById('save-episode-btn');
        saveBtn.disabled = true;
        saveBtn.textContent = 'SAVING...';
        
        const episodeData = {
            id: id || `ep_${Date.now()}`,
            season: season,
            episode: episodeNum,
            title: title,
            thumbnail: document.getElementById('episode-thumbnail').value.trim(),
            length: document.getElementById('episode-length').value.trim(),
            airDate: document.getElementById('episode-date').value,
            summary: document.getElementById('episode-summary').value.trim(),
            fullSummary: document.getElementById('episode-full-summary').value.trim()
        };
        
        await saveEpisodeToFirebase(episodeData);
        
        saveBtn.disabled = false;
        saveBtn.textContent = 'SAVE EPISODE';
        
        closeEpisodeModal();
        alert(`Episode "${title}" saved successfully.`);
    }

    // --- DELETE MODAL ---
    function openDeleteModal(episodeId) {
        const ep = episodes.find(e => e.id === episodeId);
        if (!ep) return;
        
        deleteTargetId = episodeId;
        document.getElementById('delete-message').textContent = 
            `Are you sure you want to delete "${ep.title}"? This action cannot be undone.`;
        document.getElementById('delete-modal').classList.remove('hidden');
    }

    function closeDeleteModal() {
        document.getElementById('delete-modal').classList.add('hidden');
        deleteTargetId = null;
    }

    async function confirmDelete() {
        if (!deleteTargetId) return;
        
        await deleteEpisodeFromFirebase(deleteTargetId);
        
        closeDeleteModal();
        showEpisodeList(currentSeason);
        
        alert('Episode deleted.');
    }

    // --- UTILITY FUNCTIONS ---
    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
        });
    }
</script>

</body>
</html>
